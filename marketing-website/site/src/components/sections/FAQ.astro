---
/**
 * FAQ Section
 * Accordion FAQ using CSS-only details/summary pattern
 */

import { faqItems, categoryLabels } from '../../data/faq';
import type { FAQCategory } from '../../types';

interface Props {
  limit?: number;
  categories?: FAQCategory[];
  class?: string;
}

const {
  limit,
  categories,
  class: className = '',
} = Astro.props;

// Filter and limit FAQ items
let displayItems = faqItems;

// Filter by categories if provided
if (categories && categories.length > 0) {
  displayItems = displayItems.filter(item => categories.includes(item.category));
}

// Limit items if specified
if (limit) {
  displayItems = displayItems.slice(0, limit);
}

// Group by category for display
const groupedItems = displayItems.reduce((acc, item) => {
  if (!acc[item.category]) {
    acc[item.category] = [];
  }
  acc[item.category].push(item);
  return acc;
}, {} as Record<FAQCategory, typeof displayItems>);
---

<section class={`py-16 md:py-24 ${className}`}>
  <div class="container mx-auto px-4">
    <!-- Section Header -->
    <div class="text-center max-w-3xl mx-auto mb-12 md:mb-16">
      <h2 class="text-3xl md:text-4xl lg:text-5xl font-bold text-charcoal mb-4">
        Veelgestelde vragen
      </h2>
      <p class="text-lg md:text-xl text-gray-600 leading-relaxed">
        Alles wat je moet weten over Party Pilot
      </p>
    </div>

    <!-- FAQ Accordion -->
    <div class="max-w-3xl mx-auto space-y-8">
      {Object.entries(groupedItems).map(([category, items], catIndex) => (
        <div class="animate-slide-up" style={`animation-delay: ${catIndex * 100}ms;`}>
          {/* Category Header */}
          {!limit && (
            <h3 class="text-xl font-bold text-charcoal mb-4 pb-2 border-b-2 border-coral-500">
              {categoryLabels[category as FAQCategory]}
            </h3>
          )}

          {/* FAQ Items */}
          <div class="space-y-4">
            {items.map((item) => (
              <details class="group bg-white rounded-lg shadow-soft hover:shadow-card transition-shadow duration-200">
                <summary class="cursor-pointer list-none px-6 py-4 flex items-center justify-between gap-4">
                  <h4 class="text-lg font-semibold text-charcoal group-open:text-coral-600 transition-colors duration-200">
                    {item.question}
                  </h4>
                  <div class="flex-shrink-0 w-6 h-6 text-coral-500 transition-transform duration-200 group-open:rotate-45">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M5 12h14"/>
                      <path d="M12 5v14"/>
                    </svg>
                  </div>
                </summary>
                <div class="px-6 pb-4 pt-2">
                  <p class="text-base text-gray-600 leading-relaxed">
                    {item.answer}
                  </p>
                </div>
              </details>
            ))}
          </div>
        </div>
      ))}
    </div>

    <!-- View All Link (if limited) -->
    {limit && displayItems.length >= limit && (
      <div class="text-center mt-12">
        <a
          href="/faq"
          class="inline-flex items-center gap-2 text-lg font-semibold text-coral-600 hover:text-coral-700 transition-colors duration-200 group"
        >
          <span>Bekijk alle vragen</span>
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="group-hover:translate-x-1 transition-transform duration-200">
            <path d="M5 12h14"/>
            <path d="m12 5 7 7-7 7"/>
          </svg>
        </a>
      </div>
    )}

    <!-- Contact Support -->
    <div class="text-center mt-12 p-6 bg-gray-50 rounded-lg max-w-2xl mx-auto">
      <p class="text-base text-gray-700 mb-4">
        Staat je vraag er niet tussen?
      </p>
      <a
        href="/contact"
        class="inline-flex items-center gap-2 text-lg font-semibold text-coral-600 hover:text-coral-700 transition-colors duration-200"
      >
        <span>Neem contact met ons op</span>
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M5 12h14"/>
          <path d="m12 5 7 7-7 7"/>
        </svg>
      </a>
    </div>
  </div>
</section>

<style>
  /* Smooth accordion animation */
  details summary::-webkit-details-marker {
    display: none;
  }

  details[open] summary {
    padding-bottom: 0.5rem;
  }

  /* Add subtle animation on open */
  details[open] > div {
    animation: slideDown 0.3s ease-out;
  }

  @keyframes slideDown {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>
